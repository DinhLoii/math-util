# This workflow will build a Java project with Maven, and cache/restore any dependencies to improve the workflow execution time
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-java-with-maven

# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

# Tên workflow – sẽ hiển thị trong tab Actions của GitHub
# ================================
# CI WORKFLOW FOR JAVA ANT PROJECT
# Using Ant + JUnit 4
# ================================

# Tên workflow – hiển thị trong tab Actions
name: CI with GitHub Actions using Ant and JUnit | © 2025 by DinhLoii

# Khi nào workflow này được chạy
on:
  push:
    branches: [ "main" ]          # Chạy khi có push code lên nhánh main
  pull_request:
    branches: [ "main" ]          # Chạy khi có pull request vào nhánh main

# Một workflow có thể có nhiều job
# Ở đây chỉ cần 1 job build
jobs:
  build:
    # GitHub cấp cho ta một máy ảo chạy Ubuntu Linux
    runs-on: ubuntu-latest

    # Các bước sẽ được chạy tuần tự
    steps:

    # --------------------------------
    # BƯỚC 1: LẤY SOURCE CODE
    # --------------------------------
    - name: Check out repository
      uses: actions/checkout@v4
      # Lấy toàn bộ source code từ GitHub repo
      # để máy ảo có code mà build

    # --------------------------------
    # BƯỚC 2: CÀI ĐẶT JDK
    # --------------------------------
    - name: Set up JDK 21 (LTS)
      uses: actions/setup-java@v4
      with:
        java-version: '21'        # Dùng Java 21 – bản LTS, ổn định
        distribution: 'temurin'  # Eclipse Temurin (OpenJDK chính thức)

    # --------------------------------
    # BƯỚC 3: BUILD + TEST BẰNG ANT
    # --------------------------------
    - name: Build project with Ant
      run: ant -noinput -buildfile build.xml
      # Ant sẽ đọc file build.xml (NetBeans sinh ra)
      # Quá trình này:
      #  - Compile source code
      #  - Compile test
      #  - Chạy JUnit 4 tests
      # Nếu test FAIL → CI FAIL

    # --------------------------------
    # BƯỚC 4: CHUẨN BỊ FILE BUILD (.jar)
    # --------------------------------
    - name: Prepare build artifacts
      run: |
        mkdir -p staging
        cp dist/*.jar staging || echo "No JAR file found"
      # dist/*.jar là output mặc định của Ant (NetBeans)
      # staging là thư mục trung gian để upload artifact

    # --------------------------------
    # BƯỚC 5: UPLOAD ARTIFACT
    # --------------------------------
    - name: Upload JAR artifact
      uses: actions/upload-artifact@v4
      with:
        name: math-util-ant-build  # Tên file build hiển thị trên GitHub
        path: staging              # Thư mục chứa file .jar



# End of CI workflow file. 

# BẠN CÓ THỂ HỌC THÊM CÁC LỆNH CỦA GITHUB ACTIONS ĐỂ LÀM TIẾP QUY TRÌNH CD/DEVOPS Ở ĐÂY, 
# ĐỂ ĐẨY CÁI OUTPUT, APP, BUILD SANG CÁC SERVER KHÁC: STAGING SERVER, PRODUCTION SERVER...
